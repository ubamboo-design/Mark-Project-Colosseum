<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROJECT CAGE : 雙斧封印版</title>
<style>
:root{
--bg:#0b0b0e;--card:#141418;--bar:#1c1c22;--text:#e0e0e0;--mute:#888;--gold:#ffd700;
--tw:#ff3b3b;--us:#00d2ff;--yield:#00ff6a;--ber:#ff9100;--trap:#bd00ff;
--green:#00ff6a;--red:#ff2a2a;--purple:#a600ff;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'Segoe UI',sans-serif;line-height:1.3;overflow-x:hidden;padding-bottom:20px}
header{padding:20px;background:#08080a;border-bottom:1px solid #333;text-align:center}
h1{font-size:2.2rem;letter-spacing:4px;text-transform:uppercase;color:#fff;text-shadow:0 0 30px #ffd700;font-weight:900;margin:0}
.meta-info{font-family:'Courier New';color:#aaa;margin-top:5px;font-size:0.85rem}
.container{max-width:1600px;margin:0 auto;padding:0 20px}

/* DASHBOARD */
.dashboard-panel{background:linear-gradient(180deg,#1a1a20,#0f0f12);border:1px solid #444;border-radius:12px;padding:15px;margin-bottom:25px;box-shadow:0 0 30px rgba(0,0,0,0.6);position:relative;overflow:hidden}
.dashboard-panel::before{content:'';position:absolute;top:0;left:0;width:100%;height:3px;background:linear-gradient(90deg,var(--tw),var(--gold),var(--us))}
.dash-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;text-align:center}
.dash-label{font-size:0.8rem;color:#666;text-transform:uppercase;margin-bottom:2px;font-weight:bold}
.dash-value{font-family:'Courier New';font-size:2rem;font-weight:900;color:#fff}
.dash-roi{font-size:1.8rem;font-weight:900}

.color-profit{color:var(--green)!important;text-shadow:0 0 15px #00ff6a88}
.color-loss{color:var(--red)!important;text-shadow:0 0 15px #ff2a2a88}
.color-gold{color:var(--gold)!important;text-shadow:0 0 20px #ffd700aa}
.color-dead{color:var(--purple)!important;text-shadow:0 0 20px #bd00ffaa;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
@media(max-width:768px){.dash-grid{grid-template-columns:1fr}}

/* SECTIONS */
.section-title{font-size:1.1rem;border-left:3px solid var(--gold);padding-left:10px;margin:30px 0 15px;text-transform:uppercase;font-weight:900;color:#fff;display:flex;align-items:center}
.section-title::after{content:'';flex-grow:1;height:1px;background:#444;margin-left:15px}

/* DECK */
.deck-wrapper{overflow-x:auto;padding-bottom:10px}
.deck-grid{display:grid;grid-template-columns:repeat(7,minmax(140px,1fr));gap:10px;min-width:1000px}
.micro-card{background:var(--card);border:1px solid #333;border-radius:10px;padding:12px;transition:all .3s;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,0.5);display:flex;flex-direction:column;min-height:190px}
.micro-card:hover{transform:translateY(-5px) scale(1.02);box-shadow:0 15px 30px rgba(0,0,0,0.7);z-index:10;background:#1a1a20}

.type-tw{border-top:3px solid var(--gold)}
.type-us{border-top:3px solid var(--us)}
.type-yield{border-top:3px solid var(--yield)}
.type-ber{border-top:3px solid var(--ber)}
.type-trap{border-top:3px solid var(--trap)}

.mc-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;padding-bottom:5px;border-bottom:1px solid rgba(255,255,255,0.1)}
.mc-code{font-size:0.85rem;font-weight:900;color:#fff}
.mc-target{font-size:0.7rem;background:rgba(0,0,0,0.5);padding:1px 5px;border-radius:4px;color:#ccc}
.mc-image-container{flex-grow:1;display:flex;align-items:center;justify-content:center;margin:8px 0}
.mc-image{width:60px;height:60px;transition:all .4s}
.micro-card:hover .mc-image{transform:scale(1.2);filter:drop-shadow(0 0 15px currentColor)}
.mc-name{font-size:0.9rem;font-weight:900;text-transform:uppercase;letter-spacing:1px;color:#fff;margin-bottom:2px}
.mc-cost-badge{margin-top:5px;padding:2px 8px;border:1px solid #555;border-radius:10px;font-size:0.75rem;background:rgba(0,0,0,0.4)}

/* ARENA */
.arena-container{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:15px}
@media(max-width:1000px){.arena-container{grid-template-columns:1fr}}
.arena-group{background:rgba(255,255,255,0.02);border:1px solid #222;border-radius:8px;padding:10px}
.group-header{text-align:center;padding-bottom:6px;border-bottom:1px solid #444;font-weight:900;font-size:0.9rem;color:#fff}

.g-bar{display:flex;align-items:center;background:var(--bar);padding:14px 12px;border-radius:6px;border-left:4px solid #555;cursor:pointer;transition:.2s;position:relative}
.g-bar:hover{background:#25252e;transform:translateX(3px)}
.g-bar::after{content:'▼';position:absolute;right:12px;color:#666;font-size:0.7rem;transition:.3s}
.g-bar.active::after{transform:rotate(180deg);color:var(--gold)}

.group-tw .g-bar{border-left-color:var(--gold)}
.group-us .g-bar{border-left-color:var(--us)}
.group-mix .g-bar{border-left-color:var(--trap)}

.g-code{font-family:'Courier New';font-weight:900;color:#fff;width:40px;font-size:0.9rem}

/* --- 關鍵修改：強制對齊 --- */
.g-info{flex-grow:1;display:flex;align-items:center;padding-left:10px} 
.g-name{
    width: 155px; /* 給予固定寬度，確保右側圖示起點一致 */
    flex: 0 0 155px; /* 禁止縮放 */
    font-size:1.1rem;
    font-weight:900;
    color:#fff;
    text-transform:uppercase;
    white-space:nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.g-deck-icons{
    display:flex;
    gap:8px;
    align-items: center; /* 確保圖示垂直置中 */
}
/* --- 修改結束 --- */

.g-mini-icon{width:38px;height:38px;transition:.2s;display:inline-flex;align-items:center;justify-content:center}
.g-mini-icon:hover{transform:scale(1.2)}
.g-mini-icon svg{width:100%!important;height:100%!important;stroke:currentColor!important}

.g-stats{text-align:right;min-width:85px}
.g-roi{font-family:'Courier New';font-weight:900;font-size:0.85rem}
.g-val{font-size:0.7rem;color:#666}
.g-details{max-height:0;overflow:hidden;transition:max-height .4s cubic-bezier(0,1,0,1);background:rgba(0,0,0,0.3);border-radius:0 0 6px 6px}
.g-bar.active + .g-details{max-height:100px;border:1px solid #333;border-top:none}
.highlight-content{padding:10px;background:rgba(255,215,0,0.07);border-left:3px solid var(--gold);margin:6px;font-size:0.85rem;color:#ddd}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.95);backdrop-filter:blur(5px);display:none;align-items:center;justify-content:center;z-index:9999}
.modal-content{background:#1a1a20;border:2px solid #444;border-radius:12px;padding:25px;max-width:450px;width:90%;box-shadow:0 0 50px rgba(0,0,0,0.9)}
.modal-header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #444;padding-bottom:10px;margin-bottom:15px}
.m-code{font-size:1.8rem;font-weight:900;color:#fff}
.m-skill{font-size:1.1rem;color:#aaa;font-weight:bold;margin-left:15px}
.close-btn{font-size:1.8rem;cursor:pointer;color:#888;line-height:1}
.close-btn:hover{color:#fff}
.m-row{margin-bottom:12px}
.m-label{display:block;font-size:0.7rem;color:#555;text-transform:uppercase;margin-bottom:3px;font-weight:bold;letter-spacing:1px}
.m-value{font-size:0.95rem;color:#ccc;line-height:1.4}
.m-value.highlight{font-size:1.4rem;font-weight:900;color:var(--gold);font-family:'Courier New'}
</style>
</head>
<body>
<header>
  <h1>PROJECT CAGE</h1>
  <div class="meta-info">v12.22 LIVE • NT$ 1,000 萬 • 2025-2031</div>
</header>

<div class="container">
  <div class="dashboard-panel">
    <div class="dash-grid">
      <div><span class="dash-label">TOTAL COST</span><div class="dash-value" id="totalCost">...</div></div>
      <div><span class="dash-label">TOTAL ASSET</span><div class="dash-value" id="totalCurrent">...</div></div>
      <div><span class="dash-label">CHANGE</span><div class="dash-roi" id="totalROI">...</div></div>
    </div>
  </div>

  <div class="section-title">I. 七大技能卡牌</div>
  <div class="deck-wrapper"><div class="deck-grid" id="cardContainer"><div class="loading">CONNECTING...</div></div></div>

  <div class="section-title">II. 投資競技場</div>
  <div class="arena-container" id="arenaContainer"><div class="loading">LOADING...</div></div>
</div>

<div id="cardModal" class="modal-overlay" onclick="closeModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div style="display:flex;align-items:baseline">
        <div class="m-code" id="mCode"></div>
        <div class="m-skill" id="mSkill"></div>
      </div>
      <span class="close-btn" onclick="closeModal()">&times;</span>
    </div>
    <div class="m-row"><span class="m-label">初始資金</span><div class="m-value highlight" id="mCost"></div></div>
    <div class="m-row"><span class="m-label">戰略定位</span><div class="m-value" id="mStrategy"></div></div>
    <div class="m-row"><span class="m-label">執行 SOP</span><div class="m-value" id="mSop" style="padding:10px;background:rgba(0,0,0,0.3);border-left:3px solid #666;border-radius:6px"></div></div>
  </div>
</div>

<script>
// 2025 終極 SVG 資源庫 (已微調垂直位置以確保對齊)
const cardAssets = {
  // C01: 金幣 (上移以置中)
  'C01':`<svg class="mc-image" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <ellipse cx="32" cy="44" rx="22" ry="9" fill="#ffd700" stroke="#b39700" stroke-width="3"/>
    <path d="M10 44v-8c0 5 10 9 22 9s22-4 22-9v8c0 5-10 9-22 9s-22-4-22-9z" fill="#ffd700" stroke="#b39700" stroke-width="3"/>
    <ellipse cx="32" cy="32" rx="22" ry="9" fill="#ffd700" stroke="#b39700" stroke-width="3"/>
    <path d="M10 32v-8c0 5 10 9 22 9s22-4 22-9v8c0 5-10 9-22 9s-22-4-22-9z" fill="#ffd700" stroke="#b39700" stroke-width="3"/>
    <ellipse cx="32" cy="20" rx="22" ry="9" fill="#ffd700" stroke="#b39700" stroke-width="3"/>
    <text x="32" y="24" font-size="20" text-anchor="middle" fill="#b39700" font-weight="900">$</text>
  </svg>`,

  // C02: 寶劍
  'C02':`<svg class="mc-image" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M14 50L46 18M10 54l8-8M6 58l4-4" stroke="currentColor" stroke-width="5" stroke-linecap="round"/>
    <path d="M42 22l4-4 8 8-4 4-8-8z" fill="currentColor" opacity="0.4"/>
    <path d="M46 18l12-12" stroke="currentColor" stroke-width="2"/>
  </svg>`,

  // C03: 股息
  'C03':`<svg class="mc-image" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M32 10 L42 28 L24 28 Z" fill="currentColor" opacity="0.3"/>
    <path d="M32 10 L42 28 L24 28 Z" stroke="currentColor" stroke-width="4"/>
    <path d="M32 42v10M26 52h12" stroke="currentColor" stroke-width="3"/>
  </svg>`,

  // C04: 雙斧 (下移以置中)
  'C04':`<svg class="mc-image" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M18 18 L26 26 L22 44 L14 52 L18 58 L26 50 L30 52 L22 60 L14 52 Z" fill="#ff9100" stroke="#ffb800" stroke-width="3"/>
    <rect x="24" y="14" width="6" height="28" rx="3" fill="#333" stroke="#666" stroke-width="2"/>
    <path d="M46 18 L38 26 L42 44 L50 52 L46 58 L38 50 L34 52 L42 60 L50 52 Z" fill="#ff9100" stroke="#ffb800" stroke-width="3"/>
    <rect x="34" y="14" width="6" height="28" rx="3" fill="#333" stroke="#666" stroke-width="2"/>
    <circle cx="32" cy="34" r="8" fill="#fff" opacity="0.9"/>
    <circle cx="32" cy="34" r="14" stroke="#ff9100" stroke-width="3" opacity="0.6"/>
  </svg>`,

  // C05: 地球儀
  'C05':`<svg class="mc-image" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="32" cy="32" r="24" stroke="currentColor" stroke-width="4"/>
    <ellipse cx="32" cy="32" rx="24" ry="10" stroke="currentColor" stroke-width="2"/>
    <line x1="32" y1="8" x2="32" y2="56" stroke="currentColor" stroke-width="2"/>
  </svg>`,

  // C06: 盾牌
  'C06':`<svg class="mc-image" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M32 8l18 6v14c0 12-18 24-18 24S14 40 14 28V14l18-6z" stroke="currentColor" stroke-width="4" fill="none"/>
    <circle cx="32" cy="26" r="8" fill="currentColor" opacity="0.3"/>
  </svg>`,

  // C07: 準心
  'C07':`<svg class="mc-image" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="32" cy="32" r="22" stroke="currentColor" stroke-width="4"/>
    <line x1="32" y1="6" x2="32" y2="20" stroke="currentColor" stroke-width="4"/>
    <line x1="32" y1="44" x2="32" y2="58" stroke="currentColor" stroke-width="4"/>
    <line x1="6" y1="32" x2="20" y2="32" stroke="currentColor" stroke-width="4"/>
    <line x1="44" y1="32" x2="58" y2="32" stroke="currentColor" stroke-width="4"/>
    <circle cx="32" cy="32" r="4" fill="currentColor"/>
  </svg>`
};

let cardsData = {}, portfolios = [];

// 連線到 Google Sheet
fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQuNQc8E7BlYLR5E6WlYHVQ3l_ki95CqcEcpS8sNQESRKcg5yECE-e2bgMvLGU-Vx5HFuWo5OS1GUIT/pub?output=tsv')
.then(r=>r.text()).then(t=>{parseSheetData(t);renderAll()})
.catch(e=>document.getElementById('cardContainer').innerHTML=`<p style="color:red">連線失敗，請檢查網路</p>`);

function parseSheetData(text){
  const rows = text.split('\n').map(r=>r.trim()).filter(r=>r);
  let isStrategy = false;
  for(let i=1;i<rows.length;i++){
    const c = rows[i].split('\t');
    if(c[0]==='代號'&&c[1]==='名稱'){isStrategy=true;continue;}
    
    if(!isStrategy && c[0]?.startsWith('C')){
      cardsData[c[0]] = {code:c[0],type:c[1],target:c[3],skill:c[4],cost:+c[5]||0,current:+c[6]||0,strategy:c[7],sop:c[8],svg:cardAssets[c[0]]||cardAssets.C01};
    }else if(isStrategy && c[0]?.startsWith('P')){
      let g='mix'; if(['P01','P02','P03','P07'].includes(c[0]))g='tw'; else if(['P04','P05','P06'].includes(c[0]))g='us';
      portfolios.push({code:c[0],name:c[1],deck:c[2]?c[2].split('+').map(s=>s.trim()):[],group:g,highlight:c[3]});
    }
  }
}

function calc(cost,cur){
  if(cost===0)return{roi:0,arrow:'-',cls:''};
  const roi = ((cur-cost)/cost*100).toFixed(1);
  let cls = cur>=cost*1.5?'color-gold':cur>cost?'color-profit':cur<=cost*0.5?'color-dead':'color-loss';
  return {roi,arrow:roi>=0?'▲':'▼',sign:roi>=0?'+':'',cls};
}

function renderAll(){renderDashboard();renderCards();renderArena();}

function renderDashboard(){
  let tc=0,ta=0;
  Object.values(cardsData).forEach(c=>{tc+=c.cost;ta+=c.current});
  const s=calc(tc,ta);
  document.getElementById('totalCost').textContent = '$'+tc.toLocaleString()+' 萬';
  const cur=document.getElementById('totalCurrent'); cur.textContent='$'+ta.toLocaleString()+' 萬'; cur.className='dash-value '+s.cls;
  document.getElementById('totalROI').innerHTML = `<span class="${s.cls}">${s.arrow} ${s.sign}${s.roi}%</span>`;
}

function renderCards(){
  const con=document.getElementById('cardContainer'); con.innerHTML='';
  Object.values(cardsData).forEach(c=>{
    con.innerHTML+=`<div class="micro-card ${c.type}" onclick="openModal('${c.code}')">
      <div class="mc-header"><span class="mc-code">${c.code}</span><span class="mc-target">${c.target}</span></div>
      <div class="mc-image-container">${c.svg}</div>
      <div class="mc-footer"><div class="mc-name">${c.skill}</div><div class="mc-cost-badge">$${c.cost}萬</div></div>
    </div>`;
  });
}

function renderArena(){
  const con=document.getElementById('arenaContainer');
  const g={tw:[],us:[],mix:[]};
  
  portfolios.forEach(p=>{
    let tc=0,ta=0;
    const icons=p.deck.map(code=>{
      const c=cardsData[code];
      let typeClass = c ? c.type : '';
      return c ? `<span class="g-mini-icon ${typeClass}">${c.svg}</span>` : '';
    }).join('');
    
    p.deck.forEach(d=>cardsData[d]&&(tc+=cardsData[d].cost,ta+=cardsData[d].current));
    const s=calc(tc,ta);
    
    const html=`
      <div class="g-bar" onclick="this.classList.toggle('active')">
        <div class="g-code">${p.code}</div>
        <div class="g-info">
          <span class="g-name" title="${p.name}">${p.name}</span>
          <div class="g-deck-icons">${icons}</div>
        </div>
        <div class="g-stats">
          <span class="g-roi ${s.cls}">${s.arrow} ${s.sign}${s.roi}%</span>
          <span class="g-val">$${ta}萬</span>
        </div>
      </div>
      <div class="g-details"><div class="highlight-content">亮點：${p.highlight||'無'}</div></div>`;
    g[p.group].push(html);
  });
  
  con.innerHTML=`
    <div class="arena-group group-tw"><div class="group-header">TAIWAN LEAGUE</div>${g.tw.join('')}</div>
    <div class="arena-group group-us"><div class="group-header">US LEAGUE</div>${g.us.join('')}</div>
    <div class="arena-group group-mix"><div class="group-header">SPECIAL LEAGUE</div>${g.mix.join('')}</div>`;
}

function openModal(k){
  const c=cardsData[k];
  document.getElementById('mCode').textContent=c.code;
  document.getElementById('mSkill').textContent=c.skill;
  document.getElementById('mCost').textContent=`$${c.cost} 萬`;
  document.getElementById('mStrategy').textContent=c.strategy;
  document.getElementById('mSop').textContent=c.sop;
  
  const map={'type-tw':'--gold','type-us':'--us','type-yield':'--yield','type-ber':'--ber','type-trap':'--trap'};
  const color=getComputedStyle(document.documentElement).getPropertyValue(map[c.type]||'--gold').trim();
  document.querySelector('.modal-content').style.borderColor=color;
  
  document.getElementById('cardModal').style.display='flex';
}

function closeModal(){document.getElementById('cardModal').style.display='none'}
document.addEventListener('keydown',e=>e.key==='Escape'&&closeModal());
</script>
</body>
</html>
